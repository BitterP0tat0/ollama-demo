import { Readable } from 'node:stream';
import { HttpAdapterOptions, InversifyHttpAdapter, RouterParams, HttpStatusCode, ErrorFilter, Guard, Interceptor, Middleware } from '@inversifyjs/http-core';
import express, { Request, Response, NextFunction, Application } from 'express';
import { Container } from 'inversify';

interface ExpressHttpAdapterOptions extends HttpAdapterOptions {
    useCookies?: boolean;
    useJson?: boolean;
    useText?: boolean;
    useUrlEncoded?: boolean;
}

interface ExpressParams {
    [key: string]: string | string[];
    [key: number]: string;
}
declare class InversifyExpressHttpAdapter extends InversifyHttpAdapter<Request, Response, NextFunction, void, ExpressHttpAdapterOptions, Application, ExpressParams> {
    readonly id: symbol;
    constructor(container: Container, httpAdapterOptions?: ExpressHttpAdapterOptions, customApp?: Application);
    protected _buildApp(customApp: Application | undefined): Application;
    protected _buildDefaultExpressApp(customApp?: Application): Application;
    protected _buildRouter(routerParams: RouterParams<Request, Response, NextFunction, void>): void;
    protected _replyText(_request: Request, response: Response, value: string): void;
    protected _replyJson(_request: Request, response: Response, value?: object): void;
    protected _replyStream(_request: Request, response: Response, value: Readable): void;
    protected _sendBodySeparator(_request: Request, response: Response): void;
    protected _setStatus(_request: Request, response: Response, statusCode: HttpStatusCode): void;
    protected _setHeader(_request: Request, response: Response, key: string, value: string): void;
    protected _getBody(request: Request, _response: Response, parameterName?: string): unknown;
    protected _getParams(request: express.Request): ExpressParams;
    protected _getParams(request: express.Request, parameterName: string): string | string[] | undefined;
    protected _getQuery(request: express.Request): Record<string, unknown>;
    protected _getQuery(request: express.Request, parameterName: string): unknown;
    protected _getHeaders(request: express.Request): Record<string, string | string[] | undefined>;
    protected _getHeaders(request: express.Request, parameterName: string): string | string[] | undefined;
    protected _getCookies(request: Request, _response: Response, parameterName?: string): unknown;
}

type ExpressErrorFilter<TError = unknown> = ErrorFilter<TError, express.Request, express.Response, void>;

type ExpressGuard = Guard<express.Request>;

type ExpressInterceptor = Interceptor<express.Request, express.Response>;

type ExpressMiddleware = Middleware<express.Request, express.Response, express.NextFunction, void>;

export { InversifyExpressHttpAdapter };
export type { ExpressErrorFilter, ExpressGuard, ExpressHttpAdapterOptions, ExpressInterceptor, ExpressMiddleware };
