"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.buildInterceptedHandler = buildInterceptedHandler;
function buildInterceptedHandler(interceptorList, container, callRouteHandler, handleError, reply) {
    if (interceptorList.length === 0) {
        return async (request, response, next) => {
            try {
                const value = await callRouteHandler(request, response, next);
                return await reply(request, response, value);
            }
            catch (error) {
                return handleError(request, response, error);
            }
        };
    }
    return async (request, response, next) => {
        const transforms = [];
        const transformObject = {
            push: (transform) => {
                transforms.push(transform);
            },
        };
        let handlerResult;
        const nextFunction = (index) => {
            if (index < interceptorList.length) {
                return async () => {
                    const interceptor = await container.getAsync(interceptorList[index]);
                    await interceptor.intercept(request, response, nextFunction(index + 1));
                    return transformObject;
                };
            }
            else {
                return async () => {
                    handlerResult = await callRouteHandler(request, response, next);
                    return transformObject;
                };
            }
        };
        try {
            await nextFunction(0)();
            for (const transform of transforms) {
                handlerResult = (await transform(handlerResult));
            }
            return await reply(request, response, handlerResult);
        }
        catch (error) {
            return handleError(request, response, error);
        }
    };
}
//# sourceMappingURL=buildInterceptedHandler.js.map